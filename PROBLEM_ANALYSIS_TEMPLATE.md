# ИНСТРУКЦИЯ: КАК АНАЛИЗИРОВАТЬ ПРОБЛЕМЫ (для CLAUDE.md)

## КОГДА КОД НЕ РАБОТАЕТ - СТОП! НЕ УПРОЩАЙ, А АНАЛИЗИРУЙ!

### Шаблон анализа проблемы:

## КОД С ПРОБЛЕМОЙ:
```python
# Показать ТОЧНЫЙ код который вызывает проблему
# Не весь файл, а именно проблемную функцию/блок
```

## СИМПТОМЫ:
- Что происходит: зависание/ошибка/неправильный результат
- Где именно: строка/функция/момент выполнения
- Воспроизводимость: всегда/иногда/при определённых условиях

## КЛЮЧЕВЫЕ ВОПРОСЫ О ПРОБЛЕМЕ:

### 1. **Вычислительная сложность**
- Сколько операций делает проблемный код?
- O(n) или O(n²) или хуже?
- Где узкое место?

### 2. **Математическая корректность**
- Правильные ли формулы?
- Правильные ли знаки?
- Правильная ли нормировка?

### 3. **Численная стабильность**
- Есть ли деление на малые числа?
- Есть ли вычитание близких чисел?
- Накапливается ли ошибка?

### 4. **Концептуальные вопросы**
- Правильно ли мы понимаем задачу?
- Все ли условия учтены?
- Нет ли скрытых предположений?

## ДАННЫЕ ДЛЯ ОТЛАДКИ:

```python
# Промежуточные результаты которые помогут понять проблему
# Например:
print(f"Значение на входе: {input_val}")
print(f"После преобразования: {transformed}")
print(f"Ожидалось: {expected}")
```

## ГИПОТЕЗЫ (ранжированные по вероятности):

1. **Наиболее вероятная причина**: [описание]
   - Как проверить: [конкретный тест]
   - Что изменить: [конкретное решение]

2. **Альтернативная причина**: [описание]
   - Как проверить: [тест]
   - Что изменить: [решение]

3. **Маловероятная но возможная**: [описание]

## ВОПРОСЫ ДЛЯ ЫЛШИ:

**ВОПРОС 1:** [Конкретный вопрос о математике/алгоритме]
- Контекст: [почему это важно]
- Что проверить: [как можно протестировать]

**ВОПРОС 2:** [Вопрос о предположениях]
- Где в коде: [строка/функция]
- Альтернатива: [другой подход]

**ВОПРОС 3:** [Вопрос о данных]
- Текущее значение: [что сейчас]
- Ожидаемое: [что должно быть]

## НЕ ДЕЛАТЬ:

❌ НЕ упрощать код "для отладки" - теряем суть проблемы
❌ НЕ заменять численные методы на "более простые" - меняем задачу
❌ НЕ игнорировать warnings - они часто указывают на проблему
❌ НЕ делать assumptions без проверки

## ДЕЛАТЬ:

✅ Показать ТОЧНОЕ место проблемы
✅ Дать КОНКРЕТНЫЕ числа и примеры
✅ Сформулировать ПРОВЕРЯЕМЫЕ гипотезы
✅ Задать ПРАВИЛЬНЫЕ вопросы
✅ Сохранить ВСЮ сложность задачи

---

# ПРИМЕР ХОРОШЕГО АНАЛИЗА:

## КОД С ПРОБЛЕМОЙ:
```python
def compute_integral(f, a, b, n=1000):
    dx = (b - a) / n
    return sum(f(a + i*dx) for i in range(n)) * dx
```

## СИМПТОМЫ:
- Зависает при n > 10000
- Для f = lambda x: exp(-x²/2) даёт 0.886 вместо √(2π) = 2.507

## ВОПРОСЫ:

**В1:** Правильная ли формула квадратуры?
- Используем левые точки, а нужна трапеция
- Нет f(b) в сумме

**В2:** Достаточна ли точность?
- dx = 0.01 при интегрировании от -50 до 50
- Но exp(-50²/2) ≈ 10⁻⁵⁴³ - машинный ноль!

**В3:** Правильные ли пределы?
- Интегрируем от a до b, но гауссиана "живёт" в [-5σ, 5σ]
- При σ=1 достаточно [-5, 5], а не [-50, 50]

## ГИПОТЕЗЫ:

1. **Численное переполнение**: exp(-2500) даёт 0 в float64
2. **Неправильная квадратура**: нужен scipy.integrate.quad
3. **Лишние вычисления**: 90% точек дают вклад < 10⁻¹⁰

---

# ЭТОТ ПОДХОД КРИТИЧЕСКИ ВАЖЕН!

Не упрощать, а ПОНИМАТЬ проблему!
Не гадать, а АНАЛИЗИРОВАТЬ!
Не молчать, а СПРАШИВАТЬ!